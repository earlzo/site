<!doctype html><html class=no-js lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Jupyter Notebook 前端交互部件实现 - Life Log</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content><meta property="og:title" content="Jupyter Notebook 前端交互部件实现"><meta property="og:description" content="Jupyter Notebook 介绍1 Jupyter Notebook 是一个基于提供了开发, 记录, 执行和展现结果等过程的Web应用. Jupyter Notebook 实现原理2 Jupyter Notebook 除了用于前端交互的 Web组件外, 其核心功能是与"><meta property="og:type" content="article"><meta property="og:url" content="//elonzhou.com/post/jupyter-notebook-%E5%89%8D%E7%AB%AF%E4%BA%A4%E4%BA%92%E9%83%A8%E4%BB%B6%E5%AE%9E%E7%8E%B0/"><meta property="article:published_time" content="2016-11-25T00:00:00+00:00"><meta property="article:modified_time" content="2016-11-25T00:00:00+00:00"><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=//elonzhou.com/css/style.css><link rel=stylesheet href=//elonzhou.com/css/override.css><link rel="shortcut icon" href=//elonzhou.com/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-154636972-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class=logo><a class=logo__link href=//elonzhou.com/ title="Life Log" rel=home><div class=logo__title>Life Log</div><div class=logo__tagline>Don&#39;t panic</div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=//elonzhou.com/><span class=menu__text>Blog</span></a></li><li class=menu__item><a class=menu__link href=//elonzhou.com/about/><span class=menu__text>About</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Jupyter Notebook 前端交互部件实现</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2016-11-25T00:00:00>2016-11-25</time></div><div class="meta__item-categories meta__item"><svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2 1 2h8v11H0V2z"/></svg><span class=meta__text><a class=meta__link href=//elonzhou.com/categories/python/ rel=category>Python</a></span></div></div></header><div class="post__toc toc"><div class=toc__title>目录</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#jupyter-notebook-介绍-1>Jupyter Notebook 介绍<sup class=footnote-ref id=fnref:1><a href=#fn:1>1</a></sup></a></li><li><a href=#jupyter-notebook-实现原理-2>Jupyter Notebook 实现原理<sup class=footnote-ref id=fnref:2><a href=#fn:2>2</a></sup></a><ul><li><a href=#ipython-内核>IPython 内核</a></li><li><a href=#jupyter-notebook>Jupyter Notebook</a></li></ul></li><li><a href=#jupyter-notebook-交互部件的实现-3-4>Jupyter Notebook 交互部件的实现<sup class=footnote-ref id=fnref:3><a href=#fn:3>3</a></sup><sup class=footnote-ref id=fnref:4><a href=#fn:4>4</a></sup></a><ul><li><a href=#python-代码>Python 代码</a></li><li><a href=#javascript-代码>JavaScript 代码</a></li><li><a href=#整合>整合</a></li></ul></li></ul></nav></div></div><div class="content post__content clearfix"><h1 id=jupyter-notebook-介绍-1>Jupyter Notebook 介绍<sup class=footnote-ref id=fnref:1><a href=#fn:1>1</a></sup></h1><p>Jupyter Notebook 是一个基于提供了开发, 记录, 执行和展现结果等过程的Web应用.</p><h1 id=jupyter-notebook-实现原理-2>Jupyter Notebook 实现原理<sup class=footnote-ref id=fnref:2><a href=#fn:2>2</a></sup></h1><p>Jupyter Notebook 除了用于前端交互的 Web组件外, 其核心功能是与通过 IPython 内核通信实现的.</p><h2 id=ipython-内核>IPython 内核</h2><p>IPython 内核是一个提供了代码执行, 输入提示等功能的独立进程, 前端通过 ZeroMQ 套接字连接并使用 JSON 消息通信.</p><p><img src=http://jupyter.readthedocs.io/en/latest/_images/ipy_kernel_and_terminal.png alt="IPython 内核"></p><h2 id=jupyter-notebook>Jupyter Notebook</h2><p>Jupyter Notebook 的实现添加了一个额外的服务中间件来完成消息的转发工作, 这样不仅能够提供本身文件管理方面的功能, 也使得其内核变成一个可替换的组件, 这也是为什么 Jupyter Notebook 能够作为多种语言前端的原因.</p><p><img src=http://jupyter.readthedocs.io/en/latest/_images/notebook_components.png alt="Jupyter Notebook"></p><h1 id=jupyter-notebook-交互部件的实现-3-4>Jupyter Notebook 交互部件的实现<sup class=footnote-ref id=fnref:3><a href=#fn:3>3</a></sup><sup class=footnote-ref id=fnref:4><a href=#fn:4>4</a></sup></h1><p>本质上, Jupyter Notebook 交互部件是一个特殊的 Jupyter Notebook 插件, 它的前端使用 JavaScript 编写, 后端逻辑由指定的内核语言编写, 在这里我们使用的是 Python, 因此我们直接继承 <code>ipywidgets.DOMWidget</code> 来完成核心逻辑的实现, 这里我们需要 <code>traitlets</code> 模块来帮我们完成前后端数据的同步.</p><p>基本结构如下:</p><p><img src=https://ipywidgets.readthedocs.io/en/latest/_images/WidgetModelView.png alt=image></p><h2 id=python-代码>Python 代码</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python><span style=color:#00a8c8>class</span> <span style=color:#75af00>FileUploadWidget</span><span style=color:#111>(</span><span style=color:#111>ipywidgets</span><span style=color:#f92672>.</span><span style=color:#111>DOMWidget</span><span style=color:#111>):</span>
    <span style=color:#111>_view_name</span> <span style=color:#f92672>=</span> <span style=color:#111>traitlets</span><span style=color:#f92672>.</span><span style=color:#111>Unicode</span><span style=color:#111>(</span><span style=color:#d88200>&#39;FileUploadView&#39;</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>tag</span><span style=color:#111>(</span><span style=color:#111>sync</span><span style=color:#f92672>=</span><span style=color:#111>True</span><span style=color:#111>)</span>
    <span style=color:#111>_view_module</span> <span style=color:#f92672>=</span> <span style=color:#111>traitlets</span><span style=color:#f92672>.</span><span style=color:#111>Unicode</span><span style=color:#111>(</span><span style=color:#d88200>&#39;fileupload&#39;</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>tag</span><span style=color:#111>(</span><span style=color:#111>sync</span><span style=color:#f92672>=</span><span style=color:#111>True</span><span style=color:#111>)</span>

    <span style=color:#111>accept</span> <span style=color:#f92672>=</span> <span style=color:#111>traitlets</span><span style=color:#f92672>.</span><span style=color:#111>Unicode</span><span style=color:#111>(</span><span style=color:#111>help</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;Filetype acceptable.&#39;</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>tag</span><span style=color:#111>(</span><span style=color:#111>sync</span><span style=color:#f92672>=</span><span style=color:#111>True</span><span style=color:#111>)</span>
    <span style=color:#111>filename</span> <span style=color:#f92672>=</span> <span style=color:#111>traitlets</span><span style=color:#f92672>.</span><span style=color:#111>Unicode</span><span style=color:#111>(</span><span style=color:#111>help</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;Filename of `data`.&#39;</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>tag</span><span style=color:#111>(</span><span style=color:#111>sync</span><span style=color:#f92672>=</span><span style=color:#111>True</span><span style=color:#111>)</span>
    <span style=color:#111>data_base64</span> <span style=color:#f92672>=</span> <span style=color:#111>traitlets</span><span style=color:#f92672>.</span><span style=color:#111>Unicode</span><span style=color:#111>(</span><span style=color:#111>help</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;File content, base64 encoded.&#39;</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>tag</span><span style=color:#111>(</span>
        <span style=color:#111>sync</span><span style=color:#f92672>=</span><span style=color:#111>True</span><span style=color:#111>)</span>
    <span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>traitlets</span><span style=color:#f92672>.</span><span style=color:#111>Bytes</span><span style=color:#111>(</span><span style=color:#111>help</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;File content.&#39;</span><span style=color:#111>)</span>

    <span style=color:#00a8c8>def</span> <span style=color:#111>__init__</span><span style=color:#111>(</span><span style=color:#111>self</span><span style=color:#111>,</span> <span style=color:#111>accept</span><span style=color:#111>,</span> <span style=color:#f92672>*</span><span style=color:#111>args</span><span style=color:#111>,</span> <span style=color:#f92672>**</span><span style=color:#111>kwargs</span><span style=color:#111>):</span>
        <span style=color:#111>super</span><span style=color:#111>(</span><span style=color:#111>FileUploadWidget</span><span style=color:#111>,</span> <span style=color:#111>self</span><span style=color:#111>)</span><span style=color:#f92672>.</span><span style=color:#111>__init__</span><span style=color:#111>(</span><span style=color:#f92672>*</span><span style=color:#111>args</span><span style=color:#111>,</span> <span style=color:#f92672>**</span><span style=color:#111>kwargs</span><span style=color:#111>)</span>
        <span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>_dom_classes</span> <span style=color:#f92672>+=</span> <span style=color:#111>(</span><span style=color:#d88200>&#39;widget_item&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;btn-group&#39;</span><span style=color:#111>)</span>
        <span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>accept</span> <span style=color:#f92672>=</span> <span style=color:#111>accept</span>

    <span style=color:#00a8c8>def</span> <span style=color:#75af00>_data_base64_changed</span><span style=color:#111>(</span><span style=color:#111>self</span><span style=color:#111>,</span> <span style=color:#f92672>*</span><span style=color:#111>args</span><span style=color:#111>):</span>
        <span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>data</span> <span style=color:#f92672>=</span> <span style=color:#111>base64</span><span style=color:#f92672>.</span><span style=color:#111>b64decode</span><span style=color:#111>(</span><span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>data_base64</span><span style=color:#f92672>.</span><span style=color:#111>split</span><span style=color:#111>(</span><span style=color:#d88200>&#39;,&#39;</span><span style=color:#111>,</span> <span style=color:#ae81ff>1</span><span style=color:#111>)[</span><span style=color:#ae81ff>1</span><span style=color:#111>])</span></code></pre></div><p>这个类中, 我们实现了一个名为 <code>FileUploadWidget</code> 的部件类, 其中 <code>_view_name</code> , <code>_view_module</code> 分别是用于说明与前端哪个模块中的哪个视图进行同步, 其他四个属性则是我们需要同步的属性.</p><p>其中, 比较特殊的是 <code>data</code> 属性, 由于我们上传文件使用的是 <code>&lt;input type=&quot;file&quot;/&gt;</code> 标签, 然后利用浏览器接口 <code>FileReader</code> 读取文件内容, 而其内容是经过 <code>base_64</code> 编码的, 为了使用上的方便, 我们将前端读到的 base64 编码内容存到 <code>data_base64</code> 属性中, 再通过实现 <code>_data_base64_changed</code> 事件回调函数, 当文件内容发生变化时, 自动将 base64 编码内容转换为字节数组.</p><h2 id=javascript-代码>JavaScript 代码</h2><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-JavaScript data-lang=JavaScript><span style=color:#75af00>requirejs</span><span style=color:#111>.</span><span style=color:#75af00>undef</span><span style=color:#111>(</span><span style=color:#d88200>&#39;fileupload&#39;</span><span style=color:#111>);</span>
<span style=color:#75af00>define</span><span style=color:#111>(</span><span style=color:#d88200>&#39;fileupload&#39;</span><span style=color:#111>,</span> <span style=color:#111>[</span><span style=color:#d88200>&#39;jupyter-js-widgets&#39;</span><span style=color:#111>],</span> <span style=color:#00a8c8>function</span> <span style=color:#111>(</span><span style=color:#75af00>widgets</span><span style=color:#111>)</span> <span style=color:#111>{</span>
    <span style=color:#d88200>&#39;use strict&#39;</span><span style=color:#111>;</span>
    <span style=color:#00a8c8>let</span> <span style=color:#75af00>FileUploadView</span> <span style=color:#f92672>=</span> <span style=color:#75af00>widgets</span><span style=color:#111>.</span><span style=color:#75af00>DOMWidgetView</span><span style=color:#111>.</span><span style=color:#75af00>extend</span><span style=color:#111>({</span>
        <span style=color:#75af00>render</span><span style=color:#f92672>:</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>render</span> <span style=color:#111>()</span> <span style=color:#111>{</span>
            <span style=color:#75af00>FileUploadView</span><span style=color:#111>.</span><span style=color:#75af00>__super__</span><span style=color:#111>.</span><span style=color:#75af00>render</span><span style=color:#111>.</span><span style=color:#75af00>apply</span><span style=color:#111>(</span><span style=color:#00a8c8>this</span><span style=color:#111>,</span> <span style=color:#75af00>arguments</span><span style=color:#111>);</span>
            <span style=color:#00a8c8>let</span> <span style=color:#75af00>element</span> <span style=color:#f92672>=</span> <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>createElement</span><span style=color:#111>(</span><span style=color:#d88200>&#39;input&#39;</span><span style=color:#111>);</span>
            <span style=color:#75af00>element</span><span style=color:#111>.</span><span style=color:#75af00>setAttribute</span><span style=color:#111>(</span><span style=color:#d88200>&#39;type&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;file&#39;</span><span style=color:#111>);</span>
            <span style=color:#75af00>element</span><span style=color:#111>.</span><span style=color:#75af00>setAttribute</span><span style=color:#111>(</span><span style=color:#d88200>&#39;accept&#39;</span><span style=color:#111>,</span> <span style=color:#00a8c8>this</span><span style=color:#111>.</span><span style=color:#75af00>model</span><span style=color:#111>.</span><span style=color:#75af00>get</span><span style=color:#111>(</span><span style=color:#d88200>&#39;accept&#39;</span><span style=color:#111>));</span>

            <span style=color:#00a8c8>this</span><span style=color:#111>.</span><span style=color:#75af00>el</span><span style=color:#111>.</span><span style=color:#75af00>appendChild</span><span style=color:#111>(</span><span style=color:#75af00>element</span><span style=color:#111>);</span>
            <span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#d88200>/^image\//</span><span style=color:#111>.</span><span style=color:#75af00>test</span><span style=color:#111>(</span><span style=color:#00a8c8>this</span><span style=color:#111>.</span><span style=color:#75af00>model</span><span style=color:#111>.</span><span style=color:#75af00>get</span><span style=color:#111>(</span><span style=color:#d88200>&#39;accept&#39;</span><span style=color:#111>))){</span>
                <span style=color:#00a8c8>let</span> <span style=color:#75af00>img</span> <span style=color:#f92672>=</span> <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>createElement</span><span style=color:#111>(</span><span style=color:#d88200>&#34;img&#34;</span><span style=color:#111>);</span>
                <span style=color:#75af00>img</span><span style=color:#111>.</span><span style=color:#75af00>setAttribute</span><span style=color:#111>(</span><span style=color:#d88200>&#39;id&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;uploadPreview&#39;</span><span style=color:#111>);</span>
                <span style=color:#75af00>img</span><span style=color:#111>.</span><span style=color:#75af00>setAttribute</span><span style=color:#111>(</span><span style=color:#d88200>&#39;width&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;80%&#39;</span><span style=color:#111>);</span>
                <span style=color:#00a8c8>this</span><span style=color:#111>.</span><span style=color:#75af00>el</span><span style=color:#111>.</span><span style=color:#75af00>appendChild</span><span style=color:#111>(</span><span style=color:#75af00>img</span><span style=color:#111>);</span>
            <span style=color:#111>}</span>
        <span style=color:#111>},</span>
        <span style=color:#75af00>events</span><span style=color:#f92672>:</span> <span style=color:#111>{</span>
            <span style=color:#d88200>&#39;change&#39;</span><span style=color:#f92672>:</span> <span style=color:#d88200>&#39;_handleFileChange&#39;</span>
        <span style=color:#111>},</span>
        <span style=color:#75af00>_handleFileChange</span><span style=color:#f92672>:</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>_handleFileChange</span> <span style=color:#111>(</span><span style=color:#75af00>ev</span><span style=color:#111>)</span> <span style=color:#111>{</span>
            <span style=color:#00a8c8>let</span> <span style=color:#75af00>file</span> <span style=color:#f92672>=</span> <span style=color:#75af00>ev</span><span style=color:#111>.</span><span style=color:#75af00>target</span><span style=color:#111>.</span><span style=color:#75af00>files</span><span style=color:#111>[</span><span style=color:#ae81ff>0</span><span style=color:#111>];</span>
            <span style=color:#00a8c8>let</span> <span style=color:#75af00>that</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>this</span><span style=color:#111>;</span>
            <span style=color:#00a8c8>if</span> <span style=color:#111>(</span><span style=color:#75af00>file</span><span style=color:#111>)</span> <span style=color:#111>{</span>
                <span style=color:#75715e>// https://developer.mozilla.org/zh-CN/docs/Web/API/FileReader
</span><span style=color:#75715e></span>                <span style=color:#00a8c8>let</span> <span style=color:#75af00>fileReader</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>new</span> <span style=color:#75af00>FileReader</span><span style=color:#111>();</span>
                <span style=color:#75af00>fileReader</span><span style=color:#111>.</span><span style=color:#75af00>onload</span> <span style=color:#f92672>=</span> <span style=color:#00a8c8>function</span> <span style=color:#75af00>fileReaderOnload</span> <span style=color:#111>(</span><span style=color:#75af00>e</span><span style=color:#111>)</span> <span style=color:#111>{</span>
                    <span style=color:#75af00>that</span><span style=color:#111>.</span><span style=color:#75af00>model</span><span style=color:#111>.</span><span style=color:#75af00>set</span><span style=color:#111>(</span><span style=color:#d88200>&#39;data_base64&#39;</span><span style=color:#111>,</span> <span style=color:#75af00>fileReader</span><span style=color:#111>.</span><span style=color:#75af00>result</span><span style=color:#111>);</span>
                    <span style=color:#75af00>that</span><span style=color:#111>.</span><span style=color:#75af00>touch</span><span style=color:#111>();</span>
                    <span style=color:#00a8c8>let</span> <span style=color:#75af00>preview</span> <span style=color:#f92672>=</span> <span style=color:#111>document</span><span style=color:#111>.</span><span style=color:#75af00>getElementById</span><span style=color:#111>(</span><span style=color:#d88200>&#34;uploadPreview&#34;</span><span style=color:#111>);</span>
                    <span style=color:#00a8c8>if</span><span style=color:#111>(</span><span style=color:#75af00>preview</span> <span style=color:#f92672>!==</span> <span style=color:#00a8c8>null</span><span style=color:#111>){</span>
                        <span style=color:#75af00>preview</span><span style=color:#111>.</span><span style=color:#75af00>src</span> <span style=color:#f92672>=</span> <span style=color:#75af00>e</span><span style=color:#111>.</span><span style=color:#75af00>target</span><span style=color:#111>.</span><span style=color:#75af00>result</span><span style=color:#111>;</span>
                    <span style=color:#111>}</span>
                <span style=color:#111>};</span>
                <span style=color:#75af00>fileReader</span><span style=color:#111>.</span><span style=color:#75af00>readAsDataURL</span><span style=color:#111>(</span><span style=color:#75af00>file</span><span style=color:#111>);</span>
            <span style=color:#111>}</span>
            <span style=color:#00a8c8>else</span> <span style=color:#111>{</span>
                <span style=color:#75af00>that</span><span style=color:#111>.</span><span style=color:#75af00>send</span><span style=color:#111>({</span> <span style=color:#75af00>ev</span><span style=color:#f92672>:</span> <span style=color:#d88200>&#39;Unable to open file.&#39;</span> <span style=color:#111>});</span>
            <span style=color:#111>}</span>
            <span style=color:#75af00>that</span><span style=color:#111>.</span><span style=color:#75af00>model</span><span style=color:#111>.</span><span style=color:#75af00>set</span><span style=color:#111>(</span><span style=color:#d88200>&#39;filename&#39;</span><span style=color:#111>,</span> <span style=color:#75af00>file</span><span style=color:#111>.</span><span style=color:#75af00>name</span><span style=color:#111>);</span>
            <span style=color:#75af00>that</span><span style=color:#111>.</span><span style=color:#75af00>touch</span><span style=color:#111>();</span>
        <span style=color:#111>}</span>
    <span style=color:#111>});</span>
    <span style=color:#00a8c8>return</span> <span style=color:#111>{</span><span style=color:#75af00>FileUploadView</span><span style=color:#f92672>:</span> <span style=color:#75af00>FileUploadView</span><span style=color:#111>};</span>
<span style=color:#111>});</span>
</code></pre></div><p>JavaScript 代码中, <code>render</code> 函数用于渲染前端页面, <code>events</code> 用于描述事件回调函数, 这里的基本逻辑就是当 <code>&lt;input/&gt;</code> 标签中的文件路径值变化时重新读取文件内容.</p><h2 id=整合>整合</h2><p>我们把自带的部件和我们自己实现的部件结合在一起, 统一初始化便得到了最后的交互面板.</p><div class=highlight><pre style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python><span style=color:#00a8c8>class</span> <span style=color:#75af00>InteractPanel</span><span style=color:#111>:</span>
    <span style=color:#00a8c8>def</span> <span style=color:#111>__init__</span><span style=color:#111>(</span><span style=color:#111>self</span><span style=color:#111>):</span>
        <span style=color:#75715e># 选择识别目标的部件</span>
        <span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>selection</span> <span style=color:#f92672>=</span> <span style=color:#111>ipywidgets</span><span style=color:#f92672>.</span><span style=color:#111>SelectMultiple</span><span style=color:#111>(</span>
            <span style=color:#111>options</span><span style=color:#f92672>=</span><span style=color:#111>[</span><span style=color:#d88200>&#39;Apples&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;Oranges&#39;</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;Pears&#39;</span><span style=color:#111>],</span>
            <span style=color:#111>value</span><span style=color:#f92672>=</span><span style=color:#111>[</span><span style=color:#d88200>&#39;Oranges&#39;</span><span style=color:#111>],</span>
            <span style=color:#111>description</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;需要识别的目标选项&#39;</span><span style=color:#111>,</span>
            <span style=color:#111>disabled</span><span style=color:#f92672>=</span><span style=color:#111>False</span><span style=color:#111>)</span>
        <span style=color:#75715e># 图片上传部件</span>
        <span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>image</span> <span style=color:#f92672>=</span> <span style=color:#111>FileUploadWidget</span><span style=color:#111>(</span><span style=color:#111>accept</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;image/*&#39;</span><span style=color:#111>)</span>
        <span style=color:#75715e># 开始计算部件</span>
        <span style=color:#111>btn</span> <span style=color:#f92672>=</span> <span style=color:#111>ipywidgets</span><span style=color:#f92672>.</span><span style=color:#111>Button</span><span style=color:#111>(</span><span style=color:#111>description</span><span style=color:#f92672>=</span><span style=color:#d88200>&#39;开始&#39;</span><span style=color:#111>,</span> <span style=color:#111>disabled</span><span style=color:#f92672>=</span><span style=color:#111>False</span><span style=color:#111>)</span>
        <span style=color:#111>btn</span><span style=color:#f92672>.</span><span style=color:#111>on_click</span><span style=color:#111>(</span><span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>on_button_click</span><span style=color:#111>)</span>
        <span style=color:#75715e># 交互面板部件</span>
        <span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>panel</span> <span style=color:#f92672>=</span> <span style=color:#111>ipywidgets</span><span style=color:#f92672>.</span><span style=color:#111>Tab</span><span style=color:#111>(</span>
            <span style=color:#111>children</span><span style=color:#f92672>=</span><span style=color:#111>[</span><span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>image</span><span style=color:#111>,</span> <span style=color:#111>ipywidgets</span><span style=color:#f92672>.</span><span style=color:#111>HBox</span><span style=color:#111>([</span><span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>selection</span><span style=color:#111>,</span> <span style=color:#111>btn</span><span style=color:#111>])])</span>
        <span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>panel</span><span style=color:#f92672>.</span><span style=color:#111>set_title</span><span style=color:#111>(</span><span style=color:#ae81ff>0</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;第一步&#39;</span><span style=color:#111>)</span>
        <span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>panel</span><span style=color:#f92672>.</span><span style=color:#111>set_title</span><span style=color:#111>(</span><span style=color:#ae81ff>1</span><span style=color:#111>,</span> <span style=color:#d88200>&#39;第二步&#39;</span><span style=color:#111>)</span>

    <span style=color:#00a8c8>def</span> <span style=color:#75af00>on_button_click</span><span style=color:#111>(</span><span style=color:#111>self</span><span style=color:#111>,</span> <span style=color:#111>button</span><span style=color:#111>):</span>
        <span style=color:#75715e># 点击开始按钮所进行的操作</span>
        <span style=color:#75715e># 保存文件</span>
        <span style=color:#75715e>#with open(&#39;需要保存的文件路径&#39;, &#39;wb&#39;) as fp:</span>
        <span style=color:#75715e>#    fp.write(self.image.data)</span>
        <span style=color:#75715e># 获取选项</span>
        <span style=color:#75715e># value = self.selection.value</span>
        <span style=color:#75715e># 执行</span>
        <span style=color:#75715e>#!caffe 命令参数</span>
        <span style=color:#00a8c8>pass</span>

    <span style=color:#00a8c8>def</span> <span style=color:#75af00>display</span><span style=color:#111>(</span><span style=color:#111>self</span><span style=color:#111>):</span>
        <span style=color:#111>display</span><span style=color:#111>(</span><span style=color:#111>self</span><span style=color:#f92672>.</span><span style=color:#111>panel</span><span style=color:#111>)</span></code></pre></div><p>最终效果如:</p><p><img src=img/step1.png alt=image></p><p><img src=img/step2.png alt=image></p><p>第一步, 选择需要进行处理的图片, 第二步选择需要识别的目标, 然后点击开始按钮进行处理的工作. 整个过程只显示了一个交互面板, 同时满足的美观性和实用性的要求.</p><div class=footnotes><hr><ol><li id=fn:1><a href=http://jupyter-notebook.readthedocs.io/en/latest/notebook.html#introduction>http://jupyter-notebook.readthedocs.io/en/latest/notebook.html#introduction</a>
<a class=footnote-return href=#fnref:1><sup>[return]</sup></a></li><li id=fn:2><a href=http://jupyter.readthedocs.io/en/latest/architecture/how_jupyter_ipython_work.html#how-ipython-and-jupyter-notebook-work>http://jupyter.readthedocs.io/en/latest/architecture/how_jupyter_ipython_work.html#how-ipython-and-jupyter-notebook-work</a>
<a class=footnote-return href=#fnref:2><sup>[return]</sup></a></li><li id=fn:3><a href=https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20Custom.html>https://ipywidgets.readthedocs.io/en/latest/examples/Widget%20Custom.html</a>
<a class=footnote-return href=#fnref:3><sup>[return]</sup></a></li><li id=fn:4><a href=https://github.com/peteut/ipython-file-upload>https://github.com/peteut/ipython-file-upload</a>
<a class=footnote-return href=#fnref:4><sup>[return]</sup></a></li></ol></div></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=//elonzhou.com/tags/jupyter/ rel=tag>Jupyter</a></li></ul></div></footer></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="Elon Zhou avatar" src=//elonzhou.com/img/avatar.png class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>关于 Elon Zhou</span></div><div class=authorbox__description>一个傻子</div></div><nav class="post-nav flex"><div class="post-nav__item post-nav__item--next"><a class=post-nav__link href=//elonzhou.com/post/%E4%BD%BF%E7%94%A8python%E5%AF%BC%E5%87%BA%E6%89%87%E8%B4%9D%E5%BA%94%E7%94%A8%E6%89%93%E5%8D%A1%E6%97%A5%E5%8E%86/ rel=next><span class=post-nav__caption>下一篇&thinsp;»</span><p class=post-nav__post-title>使用Python导出扇贝应用打卡日历</p></a></div></nav><section class=comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"elonzh"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><label><input class=widget-search__field type=search placeholder=搜索... name=q aria-label=搜索...></label>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=//elonzhou.com/></form></div><div class="widget-recent widget"><h4 class=widget__title>近期文章</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=//elonzhou.com/post/celery-%E6%98%AF%E5%A6%82%E4%BD%95%E8%B7%AF%E7%94%B1%E6%B6%88%E6%81%AF%E7%9A%84/>Celery 是如何路由消息的</a></li><li class=widget__item><a class=widget__link href=//elonzhou.com/post/peeweext-%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4%E6%88%B3%E7%B2%BE%E5%BA%A6%E4%B8%A2%E5%A4%B1%E9%97%AE%E9%A2%98/>Peeweext 日期时间戳精度丢失问题</a></li><li class=widget__item><a class=widget__link href=//elonzhou.com/post/%E7%94%B5%E5%BD%B1%E6%8E%A8%E8%8D%90%E5%91%8A%E7%99%BD/>电影推荐《告白》</a></li><li class=widget__item><a class=widget__link href=//elonzhou.com/post/%E4%B8%83%E5%91%A8%E4%B8%83%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/>数据库选择和实现的微妙平衡 - 《七周七数据库》读书笔记</a></li><li class=widget__item><a class=widget__link href=//elonzhou.com/post/%E5%A5%87%E7%89%B9%E7%9A%84%E4%B8%80%E7%94%9F%E4%B9%A6%E8%AF%84/>《奇特的一生》书评</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>分类</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=//elonzhou.com/categories/go/>Go</a></li><li class=widget__item><a class=widget__link href=//elonzhou.com/categories/python/>Python</a></li><li class=widget__item><a class=widget__link href=//elonzhou.com/categories/%E9%98%85%E8%AF%BB/>阅读</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>标签</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/amqp/ title=AMQP>AMQP (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/celery/ title=Celery>Celery (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/http/ title=HTTP>HTTP (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/jupyter/ title=Jupyter>Jupyter (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/orm/ title=ORM>ORM (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/%E5%93%88%E5%B8%8C/ title=哈希>哈希 (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/%E5%BE%AE%E4%BF%A1%E8%AF%BB%E4%B9%A6/ title=微信读书>微信读书 (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/%E6%89%87%E8%B4%9D/ title=扇贝>扇贝 (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/ title=数据库>数据库 (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/%E6%97%A5%E5%8E%86/ title=日历>日历 (1)</a>
<a class="widget-taglist__link widget__link btn" href=//elonzhou.com/tags/%E7%94%B5%E5%BD%B1/ title=电影>电影 (1)</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">社交</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/elonzh target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2 76.2-25.5 131.2-97.3 131.2-182 0-105.9-86-191.7-192-191.7z"/></svg><span>GitHub</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2019 Elon Zhou.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>主題</span></div></div></footer></div><script async defer src=//elonzhou.com/js/menu.js></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async>MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']]}});</script></body></html>